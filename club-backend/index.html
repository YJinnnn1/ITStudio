<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSTUDIO | ITç ”å­¦ä¼š & ç”µç«ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Space Grotesk','sans-serif'], mono: ['JetBrains Mono','monospace'] },
                    colors: { dark:'#0B0C10', light:'#F3F4F6', teal:'#14b8a6', tealDark:'#66FCF1', tealDim:'#45A29E' }
                }
            }
        }
    </script>
    <style>
        #geo-canvas{position:fixed;top:0;left:0;width:100vw;height:100vh;display:block;z-index:0;pointer-events:none}
        :root{--bg-color:#F3F4F6;--text-main:#111827;--glass-bg:rgba(255,255,255,0.65);--glass-border:rgba(0,0,0,0.05);--glass-shadow:rgba(0,0,0,0.05);--input-bg:rgba(255,255,255,0.8);--input-text:#1F2937}
        html.dark{--bg-color:#0B0C10;--text-main:#C5C6C7;--glass-bg:rgba(11,12,16,0.75);--glass-border:rgba(255,255,255,0.08);--glass-shadow:rgba(0,0,0,0.1);--input-bg:rgba(11,12,16,0.8);--input-text:#ffffff}
        body{background-color:var(--bg-color);color:var(--text-main);overflow-x:hidden;transition:background-color .3s ease,color .3s ease;margin:0;padding:0;font-family:'Space Grotesk',sans-serif;position:relative}
        ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--bg-color)}::-webkit-scrollbar-thumb{background:#4B5563;border-radius:3px}::-webkit-scrollbar-thumb:hover{background:#14b8a6}
        .no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
        .glass{background:var(--glass-bg);backdrop-filter:blur(16px);border:1px solid var(--glass-border);box-shadow:0 4px 30px var(--glass-shadow);transition:background .3s ease,border-color .3s ease}
        .bento-card{transition:all .3s ease;position:relative;overflow:hidden}
        .bento-card:hover{transform:translateY(-5px);border-color:rgba(20,184,166,.5)}
        html.dark .bento-card:hover{border-color:rgba(102,252,241,.3);box-shadow:0 10px 30px -10px rgba(102,252,241,.15)}
        .marquee-container{overflow:hidden;position:relative;width:100%;mask-image:linear-gradient(to right,transparent,black 10%,black 90%,transparent);-webkit-mask-image:linear-gradient(to right,transparent,black 10%,black 90%,transparent)}
        .marquee-track{display:flex;width:max-content;animation:marquee 40s linear infinite}
        .marquee-content{flex-shrink:0;display:flex;align-items:center;gap:4rem;padding-right:4rem}
        .marquee-container:hover .marquee-track{animation-play-state:paused}
        .member-track{animation-duration:55s !important}
        .member-card{width:290px;flex-shrink:0}
        @keyframes marquee{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
        .chat-fade-enter{opacity:0;transform:translateY(10px);animation:fadeIn .4s forwards}
        @keyframes fadeIn{to{opacity:1;transform:translateY(0)}}
        .view-transition{transition:opacity .5s ease,transform .5s ease,filter .5s ease}
        .view-hidden{opacity:0;pointer-events:none;position:absolute;top:0;left:0;width:100%;height:0;overflow:hidden;transform:scale(.95);filter:blur(10px);z-index:-10}
        .view-visible{opacity:1;pointer-events:auto;position:relative;transform:scale(1);filter:blur(0);z-index:10}
        .theme-toggle{position:relative;width:52px;height:28px;border-radius:100px;background-color:#E5E7EB;cursor:pointer;transition:all .3s ease;box-shadow:inset 0 2px 4px rgba(0,0,0,.1)}
        html.dark .theme-toggle{background-color:#1F2833;border:1px solid rgba(255,255,255,.1)}
        .toggle-thumb{position:absolute;top:2px;left:2px;width:24px;height:24px;border-radius:50%;background-color:white;transition:all .3s cubic-bezier(.4,0,.2,1);display:flex;align-items:center;justify-content:center;box-shadow:0 2px 4px rgba(0,0,0,.2)}
        html.dark .toggle-thumb{transform:translateX(24px);background-color:#66FCF1}
        .interaction-btn{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;background:rgba(0,0,0,.05)}
        html.dark .interaction-btn{background:rgba(255,255,255,.1)}
        .interaction-btn:hover{background:rgba(20,184,166,.2);color:#14b8a6}
        html.dark .interaction-btn:hover{color:#66FCF1}
        .game-tab.active-tab{background-color:#14b8a6;color:white;box-shadow:0 4px 20px -5px rgba(20,184,166,.4)}
        html.dark .game-tab.active-tab{background-color:#66FCF1;color:black}
        .modal-animate-in{animation:modalIn .3s forwards}
        .modal-animate-out{animation:modalOut .3s forwards}
        @keyframes modalIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
        @keyframes modalOut{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.95)}}
    </style>
</head>
<body class="relative min-h-screen transition-colors duration-300">
<canvas id="geo-canvas"></canvas>

<!-- å¯¼èˆªæ  -->
<nav class="fixed top-0 w-full z-50 glass border-b border-gray-200 dark:border-white/5 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center">
        <div onclick="switchView('home')" class="font-bold text-xl tracking-tighter text-gray-900 dark:text-white flex items-center gap-2 cursor-pointer hover:opacity-80 transition">
            <i class="bi bi-box-seam text-teal dark:text-tealDark"></i> ITSTUDIO
        </div>
        <div class="flex items-center gap-4 md:gap-6">
            <div class="hidden md:flex gap-6 text-sm font-medium text-gray-600 dark:text-gray-300 items-center">
                <a href="#about" class="hover:text-teal dark:hover:text-tealDark transition">å…³äºæˆ‘ä»¬</a>
                <a href="#members" class="hover:text-teal dark:hover:text-tealDark transition">å†å±Šæˆå‘˜</a>
                <a href="#stack" class="hover:text-teal dark:hover:text-tealDark transition">æŠ€æœ¯æ ˆ</a>
                <button onclick="switchView('esports')" class="px-3 py-1 rounded-lg hover:bg-teal/10 dark:hover:bg-white/10 hover:text-teal dark:hover:text-tealDark transition flex items-center gap-1">
                    <i class="bi bi-trophy"></i> ç”µç«æ’è¡Œ
                </button>
            </div>
            <button class="interaction-btn" onclick="toggleInteraction()" title="åˆ‡æ¢äº¤äº’æ¨¡å¼">
                <i id="interaction-icon" class="bi bi-magnet-fill"></i>
            </button>
            <div class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                <div class="toggle-thumb text-xs">
                    <i class="bi bi-sun-fill text-yellow-500 dark:hidden"></i>
                    <i class="bi bi-moon-fill text-black hidden dark:block"></i>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- VIEW 1: ä¸»é¡µ -->
<div id="home-view" class="view-transition view-visible w-full">
    <section class="min-h-screen flex flex-col justify-center items-center px-4 relative z-10 max-w-5xl mx-auto pt-20">
        <div class="text-center space-y-6">
            <h1 class="text-7xl md:text-9xl font-bold text-gray-900 dark:text-white tracking-tight leading-none">
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-teal to-blue-600 dark:from-tealDark dark:to-blue-500">ITç ”å­¦ä¼š</span>
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                ç§»åŠ¨é¼ æ ‡ä»¥ä½“éªŒç²’å­ç½‘ç»œã€‚ç‚¹å‡»å³ä¸Šè§’ <i class="bi bi-magnet-fill text-teal dark:text-tealDark"></i> æŒ‰é’®å¯åˆ‡æ¢å¼•åŠ›/æ–¥åŠ›åœºã€‚
            </p>
        </div>
    </section>

    <!-- Bento Grid -->
    <section id="about" class="py-24 px-6 max-w-7xl mx-auto relative z-20">
        <div class="flex items-end justify-between mb-12">
            <div>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">ç»„ç»‡æ¶æ„ä¸æ•°æ®</h2>
                <p class="text-gray-500 dark:text-gray-400">ç¤¾å›¢è¿è¥æ•°æ®å¯è§†åŒ–é¢æ¿</p>
            </div>
            <div class="hidden md:block text-right font-mono text-xs text-teal dark:text-tealDim">æ•°æ®åŒæ­¥ï¼šåˆšåˆš</div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-4 md:grid-rows-2 gap-4 h-auto md:h-[600px]">
            <div class="md:col-span-2 md:row-span-2 glass rounded-3xl p-8 bento-card flex flex-col justify-between">
                <div>
                    <div class="w-12 h-12 bg-teal/10 rounded-xl flex items-center justify-center text-teal dark:text-tealDark mb-6"><i class="bi bi-terminal text-2xl"></i></div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">ç¼–ç  Â· åˆ›é€  Â· è¿æ¥</h3>
                    <p class="text-gray-600 dark:text-gray-400 leading-relaxed">æˆ‘ä»¬ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç¤¾å›¢ï¼Œæ›´æ˜¯ä¸€ä¸ªå¾®å‹å­µåŒ–å™¨ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æŠŠå¤©é©¬è¡Œç©ºçš„æƒ³æ³•å˜æˆè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ä»£ç ã€‚</p>
                </div>
                <div class="relative h-40 mt-6 bg-gray-100 dark:bg-gray-900/50 rounded-xl overflow-hidden border border-gray-200 dark:border-white/5">
                    <div class="p-3 font-mono text-xs text-teal dark:text-tealDark opacity-80">> git clone cs-club-v3<br>> npm install<br><span class="text-gray-800 dark:text-white">Ready on localhost:3000</span><span class="animate-pulse">_</span></div>
                </div>
            </div>
            <div class="glass rounded-3xl p-6 bento-card flex flex-col justify-center items-center text-center">
                <div class="text-5xl font-bold text-gray-900 dark:text-white mb-2">204<span class="text-teal dark:text-tealDark text-xl">+</span></div>
                <div class="text-sm text-gray-500 dark:text-gray-400 font-mono">æ´»è·ƒæ ¸å¿ƒæˆå‘˜</div>
            </div>
            <div class="glass rounded-3xl p-6 bento-card flex flex-col justify-center items-center text-center">
                <i class="bi bi-github text-4xl mb-3 text-gray-900 dark:text-white"></i>
                <div class="text-2xl font-bold text-gray-900 dark:text-white">1.2k</div>
                <div class="text-xs text-gray-500 mt-1">å¼€æºä»“åº“ STAR æ•°</div>
            </div>
            <div class="md:col-span-2 glass rounded-3xl p-6 bento-card flex items-center justify-between">
                <div>
                    <div class="text-xs text-teal dark:text-tealDark font-bold mb-1 tracking-wider">è¿‘æœŸæ´»åŠ¨</div>
                    <div id="activity-name" class="text-xl font-bold text-gray-900 dark:text-white">åŠ è½½ä¸­...</div>
                    <div id="activity-desc" class="text-xs text-gray-500 mt-1"></div>
                </div>
                <button onclick="openRegisterModal()" class="bg-teal dark:bg-tealDark text-white dark:text-black font-bold px-6 py-3 rounded-xl hover:opacity-90 transition">ç«‹å³æŠ¥å</button>
            </div>
        </div>
    </section>

    <!-- å†å±Šæˆå‘˜æµåŠ¨å± -->
    <section id="members" class="py-24 relative z-10 overflow-hidden bg-gray-200/30 dark:bg-black/10 border-y border-gray-200 dark:border-white/5">
        <div class="max-w-7xl mx-auto px-6 mb-12">
            <h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">å†å±Šæˆå‘˜</h2>
            <p class="text-gray-500 dark:text-gray-400">é‚£äº›æ›¾åœ¨è¿™é‡Œç•™ä¸‹è¶³è¿¹çš„å¼€æ‹“è€…ä»¬</p>
        </div>
        <div class="marquee-container">
            <div class="marquee-track member-track">
                <div class="marquee-content" id="member-content-1"></div>
                <div class="marquee-content" id="member-content-2" aria-hidden="true"></div>
            </div>
        </div>
    </section>

    <!-- æŠ€æœ¯æ ˆ -->
    <section id="stack" class="py-20 bg-gray-200/50 dark:bg-black/20 border-y border-gray-200 dark:border-white/5 relative z-10">
        <div class="text-center mb-10"><span class="text-xs font-mono text-gray-500 tracking-widest">åŸºäºç°ä»£æŠ€æœ¯æ ˆæ„å»º</span></div>
        <div class="marquee-container opacity-60 grayscale hover:grayscale-0 transition duration-500">
            <div class="marquee-track">
                <div class="marquee-content font-mono text-xl font-bold text-gray-400 dark:text-gray-300">
                    <span>REACT</span><span>VUE</span><span>NEXT.JS</span><span>TYPESCRIPT</span><span>PYTHON</span><span>RUST</span><span>DOCKER</span><span>KUBERNETES</span><span>GO</span><span>TAILWIND</span><span>FLUTTER</span><span>THREE.JS</span>
                </div>
                <div class="marquee-content font-mono text-xl font-bold text-gray-400 dark:text-gray-300" aria-hidden="true">
                    <span>REACT</span><span>VUE</span><span>NEXT.JS</span><span>TYPESCRIPT</span><span>PYTHON</span><span>RUST</span><span>DOCKER</span><span>KUBERNETES</span><span>GO</span><span>TAILWIND</span><span>FLUTTER</span><span>THREE.JS</span>
                </div>
            </div>
        </div>
    </section>

    <footer class="relative z-10 border-t border-gray-200 dark:border-white/10 bg-white dark:bg-[#050508] pt-16 pb-32">
        <div class="max-w-7xl mx-auto px-6 text-center text-gray-500">&copy; 2024 ITSTUDIO. ç‰ˆæƒæ‰€æœ‰.</div>
    </footer>
</div>

<!-- VIEW 2: AI èŠå¤© -->
<div id="chat-view" class="view-transition view-hidden fixed inset-0 z-40 bg-gray-50/10 dark:bg-[#0B0C10]/10 backdrop-blur-sm flex flex-col pt-16">
    <div class="h-12 border-b border-gray-200 dark:border-white/5 flex items-center justify-between px-6 bg-white/20 dark:bg-black/20">
        <div class="flex items-center gap-3">
            <div class="w-2 h-2 rounded-full bg-teal dark:bg-tealDark animate-pulse"></div>
            <span class="font-mono text-sm text-teal dark:text-tealDark tracking-wider">AI åŠ©æ‰‹ V1.0</span>
        </div>
        <div class="text-xs text-gray-500 flex items-center gap-2">æŒ‰ <kbd class="bg-gray-200 dark:bg-white/10 px-2 py-1 rounded font-mono">ESC</kbd> è¿”å›</div>
    </div>
    <div id="scroll-container" class="flex-1 overflow-y-auto p-4 md:p-8 pb-32">
        <div id="conversation-log" class="max-w-3xl mx-auto space-y-6"></div>
    </div>
</div>

<!-- VIEW 3: ç”µç«çœ‹æ¿ -->
<div id="esports-view" class="view-transition view-hidden w-full pt-28 px-4 md:px-8 pb-40 min-h-screen">
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
            <div>
                <h2 class="text-4xl md:text-6xl font-bold text-gray-900 dark:text-white mb-2 tracking-tight">E-SPORTS <span class="text-teal dark:text-tealDark">RANK</span></h2>
                <p class="text-gray-500 dark:text-gray-400 font-mono text-sm">ç¤¾å›¢å†…éƒ¨å¤©æ¢¯ / æˆ˜ç»©è¿½è¸ªç³»ç»Ÿ <span class="ml-2 px-2 py-0.5 rounded bg-gray-200 dark:bg-white/10 text-xs font-bold">æŒ‰ ESC è¿”å›é¦–é¡µ</span></p>
            </div>
            <button onclick="openUploadModal()" class="group flex items-center gap-2 bg-teal/10 hover:bg-teal dark:hover:bg-tealDark border border-teal/20 text-teal dark:text-tealDark hover:text-white dark:hover:text-black px-6 py-3 rounded-xl transition-all duration-300">
                <i class="bi bi-cloud-upload group-hover:animate-bounce"></i><span class="font-bold">æ›´æ–°æ®µä½</span>
            </button>
        </div>
        <div class="flex flex-wrap gap-3 mb-8" id="game-tabs">
            <button onclick="switchGame('valorant')" class="game-tab active-tab px-5 py-2 rounded-lg text-sm font-bold transition-all border border-transparent" data-game="valorant"><i class="bi bi-crosshair"></i> æ— ç•å¥‘çº¦</button>
            <button onclick="switchGame('naraka')" class="game-tab px-5 py-2 rounded-lg text-sm font-bold text-gray-500 hover:text-teal dark:hover:text-tealDark transition-all border border-transparent" data-game="naraka"><i class="bi bi-shield-shaded"></i> æ°¸åŠ«æ— é—´</button>
            <button onclick="switchGame('apex')" class="game-tab px-5 py-2 rounded-lg text-sm font-bold text-gray-500 hover:text-teal dark:hover:text-tealDark transition-all border border-transparent" data-game="apex"><i class="bi bi-triangle"></i> APEX</button>
            <button onclick="switchGame('lol')" class="game-tab px-5 py-2 rounded-lg text-sm font-bold text-gray-500 hover:text-teal dark:hover:text-tealDark transition-all border border-transparent" data-game="lol"><i class="bi bi-trophy"></i> è‹±é›„è”ç›Ÿ</button>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 glass rounded-3xl p-6 md:p-8 bento-card relative overflow-hidden flex flex-col">
                <div class="absolute top-0 right-0 p-4 opacity-5 pointer-events-none"><i class="bi bi-trophy-fill text-9xl text-teal dark:text-tealDark"></i></div>
                <div class="flex justify-between items-center mb-6 relative z-10">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
                        <span id="rank-title">VALORANT</span><span class="text-xs bg-teal/10 text-teal dark:text-tealDark px-2 py-1 rounded">S7 èµ›å­£</span>
                    </h3>
                    <span class="text-xs font-mono text-gray-400">SYNC: 10m ago</span>
                </div>
                <div class="overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse min-w-[500px]">
                        <thead><tr class="text-gray-400 border-b border-gray-200 dark:border-white/5 text-sm font-mono"><th class="pb-4 pl-2">#</th><th class="pb-4">MEMBER</th><th class="pb-4">RANK / SCORE</th><th class="pb-4 hidden md:table-cell">LAST UPDATE</th></tr></thead>
                        <tbody id="rank-table-body" class="text-gray-700 dark:text-gray-300"></tbody>
                    </table>
                </div>
            </div>
            <div class="flex flex-col gap-6">
                <div class="glass rounded-3xl p-6 bento-card flex flex-col items-center text-center relative overflow-hidden group">
                    <div class="absolute inset-0 bg-gradient-to-br from-teal/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="text-xs font-bold text-teal dark:text-tealDark tracking-widest mb-4 z-10">MONTHLY MVP</div>
                    <div class="w-24 h-24 rounded-full p-1 bg-gradient-to-r from-teal to-blue-500 mb-3 z-10">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full rounded-full bg-gray-900" alt="MVP">
                    </div>
                    <h4 class="text-xl font-bold text-gray-900 dark:text-white z-10">Felix_Dev</h4>
                    <p class="text-sm text-gray-500 z-10 mb-4">æ— ç•å¥‘çº¦ Â· èµ‹èƒ½æˆ˜é­‚</p>
                    <div class="flex gap-2 text-xs font-mono text-gray-400 z-10">
                        <span class="bg-black/10 dark:bg-white/10 px-2 py-1 rounded">KDA 1.8</span>
                        <span class="bg-black/10 dark:bg-white/10 px-2 py-1 rounded">HS 28%</span>
                    </div>
                </div>
                <div class="glass rounded-3xl p-6 bento-card flex-1">
                    <h4 class="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"><i class="bi bi-calendar-event text-teal dark:text-tealDark"></i> è¿‘æœŸå†…æˆ˜</h4>
                    <div class="space-y-4">
                        <div class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/5">
                            <div class="text-center w-12"><div class="text-xs text-red-500 font-bold">FEB</div><div class="text-lg font-bold text-gray-800 dark:text-white">24</div></div>
                            <div><div class="text-sm font-bold text-gray-800 dark:text-gray-200">ç“¦ç½—å…°ç‰¹ 5v5 è®­ç»ƒèµ›</div><div class="text-xs text-gray-500">20:00 @ è¯­éŸ³é¢‘é“ 1</div></div>
                        </div>
                        <div class="flex items-center gap-3 p-3 rounded-xl bg-gray-50 dark:bg-white/5 border border-gray-100 dark:border-white/5 opacity-60">
                            <div class="text-center w-12"><div class="text-xs text-gray-500 font-bold">MAR</div><div class="text-lg font-bold text-gray-800 dark:text-white">02</div></div>
                            <div><div class="text-sm font-bold text-gray-800 dark:text-gray-200">æ°¸åŠ«æ— é—´ ä¸‰æ’èµ›</div><div class="text-xs text-gray-500">å¾…å®š @ çº¿ä¸‹ç½‘å’–</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- åº•éƒ¨è¾“å…¥æ  -->
<div id="bottom-bar" class="fixed bottom-8 left-0 w-full px-4 z-[55] transition-all duration-300 pointer-events-none">
    <div class="max-w-3xl mx-auto mb-3 flex gap-2 overflow-x-auto no-scrollbar justify-center md:justify-start pb-1 pointer-events-auto">
        <button onclick="fillInput('ä»‹ç»ä¸€ä¸‹ç¤¾å›¢å†å²')" class="glass px-3 py-1.5 rounded-full text-xs font-medium text-gray-600 dark:text-gray-300 hover:text-teal dark:hover:text-tealDark border border-gray-200/50 dark:border-white/10 transition whitespace-nowrap backdrop-blur-md bg-white/40 dark:bg-black/40 cursor-pointer">ğŸ“œ ç¤¾å›¢å†å²</button>
        <button onclick="fillInput('æœ¬å­¦æœŸæŠ€æœ¯è·¯çº¿å›¾')" class="glass px-3 py-1.5 rounded-full text-xs font-medium text-gray-600 dark:text-gray-300 hover:text-teal dark:hover:text-tealDark border border-gray-200/50 dark:border-white/10 transition whitespace-nowrap backdrop-blur-md bg-white/40 dark:bg-black/40 cursor-pointer">ğŸ—ºï¸ å­¦ä¹ è·¯çº¿</button>
        <button onclick="fillInput('å¸¸ç”¨å¼€å‘è½¯ä»¶ä¸‹è½½')" class="glass px-3 py-1.5 rounded-full text-xs font-medium text-gray-600 dark:text-gray-300 hover:text-teal dark:hover:text-tealDark border border-gray-200/50 dark:border-white/10 transition whitespace-nowrap backdrop-blur-md bg-white/40 dark:bg-black/40 cursor-pointer">ğŸ’¾ è½¯ä»¶ä¸‹è½½</button>
        <button onclick="fillInput('å¦‚ä½•åŠ å…¥ç¤¾å›¢')" class="glass px-3 py-1.5 rounded-full text-xs font-medium text-gray-600 dark:text-gray-300 hover:text-teal dark:hover:text-tealDark border border-gray-200/50 dark:border-white/10 transition whitespace-nowrap backdrop-blur-md bg-white/40 dark:bg-black/40 cursor-pointer">ğŸ‘‹ åŠ å…¥æˆ‘ä»¬</button>
    </div>
    <div class="max-w-3xl mx-auto relative group pointer-events-auto">
        <div class="absolute -inset-1 bg-gradient-to-r from-teal to-blue-600 rounded-2xl blur opacity-20 group-hover:opacity-40 transition duration-500"></div>
        <div class="relative glass rounded-2xl flex items-center p-2 shadow-2xl" style="background:var(--input-bg)">
            <div class="pl-4 pr-3 text-teal dark:text-tealDark"><i class="bi bi-stars animate-pulse"></i></div>
            <input type="text" id="ai-input" class="flex-1 bg-transparent border-none focus:ring-0 h-12 text-lg font-light outline-none" style="color:var(--input-text)" placeholder="å‘ AI æé—®..." autocomplete="off">
            <button id="send-btn" class="w-12 h-12 bg-gray-900 dark:bg-gray-800 hover:bg-teal dark:hover:bg-tealDark hover:text-black text-white rounded-xl transition flex items-center justify-center cursor-pointer"><i class="bi bi-arrow-up text-xl"></i></button>
        </div>
    </div>
</div>

<!-- å¼¹çª—ï¼šä¸Šä¼ æˆ˜ç»© -->
<div id="ocr-modal" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
    <div class="glass w-full max-w-lg rounded-3xl p-8 relative" id="ocr-modal-content">
        <button onclick="closeUploadModal()" class="absolute top-6 right-6 text-gray-500 hover:text-white transition"><i class="bi bi-x-lg text-xl"></i></button>
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">ä¸Šä¼ æˆ˜ç»©æˆªå›¾</h3>
        <div class="space-y-4">
            <div><label class="block text-sm font-medium text-gray-500 mb-2">æ¸¸æˆ ID</label>
                <input type="text" id="upload-id" class="w-full bg-gray-50 dark:bg-black/30 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 text-gray-900 dark:text-white focus:outline-none focus:border-teal transition" placeholder="ä¾‹å¦‚: Player#1234"></div>
            <div class="border-2 border-dashed border-gray-300 dark:border-white/20 rounded-2xl p-8 text-center hover:border-teal transition cursor-pointer group" onclick="document.getElementById('file-upload').click()">
                <input type="file" id="file-upload" hidden accept="image/*" onchange="handleFileSelect(this)">
                <div id="upload-placeholder"><i class="bi bi-image text-4xl text-gray-400 group-hover:text-teal mb-3 block transition"></i><p class="text-sm text-gray-500">ç‚¹å‡»ä¸Šä¼ æˆªå›¾ï¼ŒAI è‡ªåŠ¨è¯†åˆ«æ®µä½</p></div>
                <img id="upload-preview" class="hidden w-full rounded-lg shadow-lg" />
            </div>
            <div id="ocr-loading" class="hidden text-center py-2"><i class="bi bi-cpu text-teal animate-spin mr-2"></i><span class="text-sm text-gray-500 animate-pulse">æ­£åœ¨åˆ†æåƒç´ ç‚¹...</span></div>
            <div id="ocr-result" class="hidden"><label class="block text-sm font-medium text-teal dark:text-tealDark mb-2">è¯†åˆ«æˆåŠŸ</label>
                <input type="text" id="result-rank" class="w-full bg-teal/5 border border-teal/20 rounded-xl px-4 py-3 text-teal dark:text-tealDark font-bold text-center"></div>
            <button id="confirm-upload-btn" onclick="submitRank()" class="w-full bg-gray-200 dark:bg-white/10 text-gray-400 font-bold py-3 rounded-xl cursor-not-allowed transition mt-4" disabled>ç¡®è®¤æ›´æ–°</button>
        </div>
    </div>
</div>

<!-- å¼¹çª—ï¼šæ´»åŠ¨æŠ¥å -->
<div id="register-modal" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-center justify-center p-4">
    <div class="glass w-full max-w-md rounded-3xl p-8 relative">
        <button onclick="closeRegisterModal()" class="absolute top-6 right-6 text-gray-500 hover:text-white transition"><i class="bi bi-x-lg text-xl"></i></button>
        <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">æ´»åŠ¨æŠ¥å</h3>
        <p id="modal-activity-name" class="text-teal dark:text-tealDark font-mono text-sm mb-6"></p>
        <div class="space-y-4">
            <div><label class="block text-sm font-medium text-gray-500 mb-2">å§“å</label>
                <input type="text" id="reg-name" class="w-full bg-gray-50 dark:bg-black/30 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 text-gray-900 dark:text-white focus:outline-none focus:border-teal transition" placeholder="è¯·è¾“å…¥çœŸå®å§“å"></div>
            <div><label class="block text-sm font-medium text-gray-500 mb-2">å­¦å·</label>
                <input type="text" id="reg-studentid" class="w-full bg-gray-50 dark:bg-black/30 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 text-gray-900 dark:text-white focus:outline-none focus:border-teal transition" placeholder="è¯·è¾“å…¥å­¦å·"></div>
            <div><label class="block text-sm font-medium text-gray-500 mb-2">è”ç³»æ–¹å¼</label>
                <input type="text" id="reg-contact" class="w-full bg-gray-50 dark:bg-black/30 border border-gray-200 dark:border-white/10 rounded-xl px-4 py-3 text-gray-900 dark:text-white focus:outline-none focus:border-teal transition" placeholder="æ‰‹æœºå·æˆ–å¾®ä¿¡"></div>
            <div id="reg-message" class="text-sm text-center hidden"></div>
            <button onclick="submitRegister()" class="w-full bg-teal dark:bg-tealDark text-white dark:text-black font-bold py-3 rounded-xl hover:opacity-90 transition mt-2">ç¡®è®¤æŠ¥å</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // 1. Canvas ç²’å­èƒŒæ™¯
    // ==========================================
    const canvas = document.getElementById('geo-canvas');
    const ctx = canvas.getContext('2d');
    let width, height, particles = [], isAttracting = true;
    let particleConfig = { color:'rgba(102,252,241,1)', lineColor:'102,252,241' };

    function updateCanvasColors() {
        const isDark = document.documentElement.classList.contains('dark');
        particleConfig.color = isDark ? 'rgba(102,252,241,1)' : 'rgba(55,65,81,0.8)';
        particleConfig.lineColor = isDark ? '102,252,241' : '55,65,81';
    }

    function toggleInteraction() {
        isAttracting = !isAttracting;
        document.getElementById('interaction-icon').className = isAttracting ? 'bi bi-magnet-fill' : 'bi bi-arrows-angle-expand';
    }

    const mouse = { x:null, y:null, radius:150 };

    function resize() {
        width = window.innerWidth; height = window.innerHeight;
        canvas.width = width; canvas.height = height;
        initParticles();
    }

    class Particle {
        constructor() {
            this.x = Math.random()*width; this.y = Math.random()*height;
            this.vx = (Math.random()-.5)*.2; this.vy = (Math.random()-.5)*.2;
            this.size = Math.random()*2+1;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x<0||this.x>width) this.vx*=-1;
            if (this.y<0||this.y>height) this.vy*=-1;
            if (mouse.x!=null) {
                let dx=mouse.x-this.x, dy=mouse.y-this.y;
                let dist=Math.sqrt(dx*dx+dy*dy);
                if (dist<mouse.radius) {
                    const fx=dx/dist, fy=dy/dist;
                    const force=(mouse.radius-dist)/mouse.radius;
                    if (isAttracting) { this.x+=fx*force*2; this.y+=fy*force*2; }
                    else { this.x-=fx*force*2; this.y-=fy*force*2; }
                }
            }
        }
        draw() {
            ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
            ctx.fillStyle=particleConfig.color; ctx.fill();
        }
    }

    function initParticles() {
        particles=[];
        let num=(width*height)/20000;
        for (let i=0;i<num;i++) particles.push(new Particle());
    }

    function connect() {
        const maxD=120, maxD2=maxD*maxD;
        for (let a=0;a<particles.length;a++) {
            for (let b=a+1;b<particles.length;b++) {
                let dx=particles[a].x-particles[b].x, dy=particles[a].y-particles[b].y;
                let d2=dx*dx+dy*dy;
                if (d2<maxD2) {
                    let op=1-d2/maxD2;
                    ctx.strokeStyle=`rgba(${particleConfig.lineColor},${op*.5})`;
                    ctx.lineWidth=1; ctx.beginPath();
                    ctx.moveTo(particles[a].x,particles[a].y);
                    ctx.lineTo(particles[b].x,particles[b].y); ctx.stroke();
                }
            }
        }
    }

    function animate() {
        requestAnimationFrame(animate); ctx.clearRect(0,0,width,height);
        particles.forEach(p=>{p.update();p.draw();}); connect();
    }

    window.addEventListener('mousemove',(e)=>{mouse.x=e.clientX;mouse.y=e.clientY;});
    window.addEventListener('mouseout',()=>{mouse.x=undefined;mouse.y=undefined;});
    window.addEventListener('resize',resize);

    // ==========================================
    // 2. è§†å›¾åˆ‡æ¢
    // ==========================================
    const views = {
        home: document.getElementById('home-view'),
        chat: document.getElementById('chat-view'),
        esports: document.getElementById('esports-view')
    };

    window.switchView = function(target) {
        Object.values(views).forEach(el=>{el.classList.remove('view-visible');el.classList.add('view-hidden');});
        views[target].classList.remove('view-hidden'); views[target].classList.add('view-visible');
        if (target==='chat') setTimeout(()=>document.getElementById('ai-input').focus(),100);
    };

    window.toggleTheme = function() {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', document.documentElement.classList.contains('dark')?'dark':'light');
        updateCanvasColors();
    };

    document.addEventListener('keydown',(e)=>{
        if (e.key==='Escape') {
            const ocrModal=document.getElementById('ocr-modal');
            const regModal=document.getElementById('register-modal');
            if (ocrModal&&!ocrModal.classList.contains('hidden')) { closeUploadModal(); return; }
            if (regModal&&!regModal.classList.contains('hidden')) { closeRegisterModal(); return; }
            if (!views.home.classList.contains('view-visible')) switchView('home');
        }
    });

    // ==========================================
    // 3. AI èŠå¤©
    // ==========================================
    const input = document.getElementById('ai-input');
    const sendBtn = document.getElementById('send-btn');
    const chatLog = document.getElementById('conversation-log');

    window.fillInput = (text)=>{input.value=text;handleSend();};

    async function handleSend() {
        const text = input.value.trim();
        if (!text) return;
        if (!views.chat.classList.contains('view-visible')) switchView('chat');
        addMessage('user', text);
        input.value = '';
        scrollToBottom();

        // åˆ›å»º AI æ°”æ³¡ï¼ˆå…ˆç©ºç€ï¼Œæµå¼å¡«å…¥ï¼‰
        const bubble = createAiBubble();

        try {
            const res = await fetch('http://localhost:8080/api/ai/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });

            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let buffer = '';
            let fullText = '';

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                buffer += decoder.decode(value, { stream: true });
                const lines = buffer.split('\n');
                buffer = lines.pop(); // ä¿ç•™ä¸å®Œæ•´çš„è¡Œ

                for (const line of lines) {
                    if (line.startsWith('data:')) {
                        const data = line.slice(5).trim();
                        if (data === '[DONE]') break;
                        fullText += data;
                        // å®æ—¶æ¸²æŸ“ Markdown
                        bubble.innerHTML = marked.parse(fullText);
                        scrollToBottom();
                    }
                }
            }
        } catch (err) {
            bubble.innerHTML = 'æ— æ³•è¿æ¥åç«¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ã€‚';
        }

        scrollToBottom();
    }

    // åˆ›å»ºç©ºçš„ AI æ°”æ³¡å¹¶æŒ‚è½½åˆ° DOM
    function createAiBubble() {
        const div = document.createElement('div');
        div.className = 'flex justify-start chat-fade-enter';
        const bubble = document.createElement('div');
        bubble.className = 'glass text-gray-800 dark:text-gray-200 px-5 py-3 rounded-2xl rounded-tl-sm border border-gray-200 dark:border-white/10 max-w-[85%] shadow-lg prose prose-sm dark:prose-invert max-w-none';
        bubble.innerHTML = '<span class="animate-pulse text-teal dark:text-tealDark">â–‹</span>';
        div.appendChild(bubble);
        chatLog.appendChild(div);
        scrollToBottom();
        return bubble;
    }

    sendBtn.onclick=handleSend;
    input.onkeypress=(e)=>{if(e.key==='Enter')handleSend();};

    function scrollToBottom(){const c=document.getElementById('scroll-container');c.scrollTo({top:c.scrollHeight,behavior:'smooth'});}

    function addMessage(role, content) {
        const div = document.createElement('div');
        div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} chat-fade-enter`;
        const bubble = document.createElement('div');
        if (role === 'user') {
            bubble.className = 'bg-teal dark:bg-tealDark text-white dark:text-black px-5 py-3 rounded-2xl rounded-tr-sm max-w-[85%] shadow-lg';
            bubble.innerHTML = content;
        } else {
            bubble.className = 'glass text-gray-800 dark:text-gray-200 px-5 py-3 rounded-2xl rounded-tl-sm border border-gray-200 dark:border-white/10 max-w-[85%] shadow-lg prose prose-sm dark:prose-invert max-w-none';
            bubble.innerHTML = marked.parse(content);
        }
        div.appendChild(bubble);
        chatLog.appendChild(div);
    }

    function addLoading() {
        const div=document.createElement('div'); div.id='ai-loading';
        div.className='flex justify-start chat-fade-enter';
        div.innerHTML=`<div class="glass px-4 py-3 rounded-2xl rounded-tl-sm border border-gray-200 dark:border-white/10 flex gap-2 items-center"><span class="w-2 h-2 bg-teal dark:bg-tealDark rounded-full animate-bounce"></span><span class="w-2 h-2 bg-teal dark:bg-tealDark rounded-full animate-bounce delay-75"></span></div>`;
        chatLog.appendChild(div);
    }
    function removeLoading(){const el=document.getElementById('ai-loading');if(el)el.remove();}


    // function getMockReply(text) {
    //     if(text.includes('å†å²')) return 'ITSTUDIO æˆç«‹äº 2018 å¹´ï¼Œç°å·²å‘å±•ä¸ºæ ¡çº§äº”æ˜Ÿç¤¾å›¢ã€‚';
    //     if(text.includes('è·¯çº¿')) return 'æœ¬å­¦æœŸï¼šå‰ç«¯(React/Vue) / åç«¯(Go/Java) / AI(PyTorch)';
    //     if(text.includes('åŠ å…¥')) return 'æ‹›æ–°é€šå¸¸åœ¨æ¯å­¦æœŸå¼€å­¦ç¬¬ä¸€å‘¨è¿›è¡Œï¼Œè¯·ç•™æ„å…¬å‘Šã€‚';
    //     return 'æ”¶åˆ°ï¼è¯·å°è¯•ç‚¹å‡»ä¸‹æ–¹å¿«æ·æŒ‡ä»¤æˆ–è®¿é—®ç¤¾å›¢ç”µç«æ¨¡å—æŸ¥çœ‹æœ€æ–°æˆ˜ç»©ã€‚';
    // }

    // ==========================================
    // 4. å†å±Šæˆå‘˜ï¼ˆå¯¹æ¥åç«¯æ•°æ®åº“ï¼‰
    // ==========================================
    // async function loadAlumniMembers() {
    //     const c1 = document.getElementById('member-content-1');
    //     const c2 = document.getElementById('member-content-2');
    //
    //     try {
    //         // ä¿®æ”¹ç‚¹ï¼šè¿™é‡Œçš„ URL å¯¹åº”ä½  Controller é‡Œçš„ @GetMapping("/members/alumni")
    //         // å¦‚æœä½ æƒ³æ˜¾ç¤ºæ‰€æœ‰æˆå‘˜ï¼Œå¯ä»¥æ”¹æˆ http://localhost:8080/api/members
    //         const res = await fetch('http://localhost:8080/api/members/alumni');
    //         const result = await res.json();
    //
    //         // è¿™é‡Œçš„ result.success å’Œ result.data å¯¹åº”ä½ åç«¯ ApiResponse çš„ç»“æ„
    //         if (result.success && result.data && result.data.length > 0) {
    //             renderMemberMarquee(result.data);
    //         } else {
    //             console.warn("åç«¯è¿”å›æ•°æ®ä¸ºç©ºï¼Œå¯ç”¨é»˜è®¤æ˜¾ç¤º");
    //             showDefaultMembers();
    //         }
    //     } catch (err) {
    //         console.error("æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡:", err);
    //         showDefaultMembers(); // å¦‚æœåç«¯æ²¡å¯åŠ¨ï¼Œä¾ç„¶æ˜¾ç¤ºé»˜è®¤å€¼é˜²æ­¢é¡µé¢ç©ºç™½
    //     }
    // }

    async function loadAlumniMembers() {
        const c1 = document.getElementById('member-content-1');
        const c2 = document.getElementById('member-content-2');

        try {
            // è¯·æ±‚å†å±Šæˆå‘˜æ¥å£
            const res = await fetch('http://localhost:8080/api/members/alumni');
            const result = await res.json();

            if (result.success && result.data && result.data.length > 0) {
                const memberList = result.data;
                const html = memberList.map(m => `
                <div class="member-card glass rounded-2xl p-6 flex items-center gap-4 border border-white/10 shadow-xl">
                    <div class="w-14 h-14 rounded-full bg-gradient-to-br from-teal to-blue-500 p-0.5 flex-shrink-0">
                        <!-- ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“å­˜çš„ avatar ç§å­ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”¨å§“å -->
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(m.avatar || m.name)}"
                             class="w-full h-full rounded-full bg-gray-900" alt="avatar">
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-900 dark:text-white">${m.name}</h4>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-teal dark:text-tealDark font-mono font-bold">${m.role}</span>
                            <span class="text-[10px] text-gray-500">${m.grade}</span>
                        </div>
                        <p class="text-[10px] text-gray-400 mt-1 italic">${m.department || ''}</p>
                        ${m.skills ? `
                            <div class="flex flex-wrap gap-1 mt-2">
                                ${m.skills.split(',').map(s => `
                                    <span class="text-[9px] bg-teal/5 text-teal/80 dark:text-tealDark/80 border border-teal/10 px-1.5 py-0.5 rounded">
                                        ${s.trim()}
                                    </span>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>`).join('');

                c1.innerHTML = html;
                c2.innerHTML = html;
            } else {
                showDefaultMembers();
            }
        } catch (err) {
            console.error("åç«¯å¯¹æ¥å¤±è´¥:", err);
            showDefaultMembers();
        }
    }

    // æå–æ¸²æŸ“é€»è¾‘
    function renderMemberMarquee(memberList) {
        const c1 = document.getElementById('member-content-1');
        const c2 = document.getElementById('member-content-2');

        const html = memberList.map(m => `
        <div class="member-card glass rounded-2xl p-6 flex items-center gap-4 border border-white/10 shadow-xl">
            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-teal to-blue-500 p-0.5 flex-shrink-0">
                <!-- ä½¿ç”¨åç«¯è¿”å›çš„åå­—ä½œä¸ºå¤´åƒç§å­ -->
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(m.name)}" class="w-full h-full rounded-full bg-gray-900" alt="avatar">
            </div>
            <div>
                <h4 class="font-bold text-gray-900 dark:text-white">${m.name}</h4>
                <!-- å¯¹åº”ä½ æ•°æ®åº“ä¸­çš„ role å­—æ®µ -->
                <p class="text-xs text-teal dark:text-tealDark font-mono tracking-wider">${m.role || 'æ ¸å¿ƒæˆå‘˜'}</p>
                <!-- å¯¹åº”ä½ æ•°æ®åº“ä¸­çš„ grade å­—æ®µ -->
                <p class="text-[10px] text-gray-500 mt-1">${m.grade || ''}</p>
                <!-- å¯¹åº”ä½ æ•°æ®åº“ä¸­çš„ skills å­—æ®µï¼ˆå‡è®¾æ˜¯é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼‰ -->
                ${m.skills ? `
                    <div class="flex flex-wrap gap-1 mt-2">
                        ${m.skills.split(',').map(s => `
                            <span class="text-[9px] bg-teal/10 text-teal dark:text-tealDark px-1.5 py-0.5 rounded">${s.trim()}</span>
                        `).join('')}
                    </div>
                ` : ''}
            </div>
        </div>`).join('');

        c1.innerHTML = html;
        c2.innerHTML = html; // å¤åˆ¶ä¸€ä»½ç”¨äºå®ç°æ— ç¼æ»šåŠ¨
    }

    // ==========================================
    // 5. æ´»åŠ¨æŠ¥åï¼ˆå¯¹æ¥åç«¯ï¼‰
    // ==========================================
    let currentActivityId=null;

    async function loadActivities() {
        try {
            const res=await fetch('http://localhost:8080/api/activities');
            const result=await res.json();
            if (result.success&&result.data.length>0) {
                const latest=result.data[0];
                currentActivityId=latest.id;
                document.getElementById('activity-name').textContent=latest.name;
                if (latest.description) document.getElementById('activity-desc').textContent=latest.description;
                document.getElementById('modal-activity-name').textContent='ğŸ“Œ '+latest.name;
            }
        } catch(err) { document.getElementById('activity-name').textContent='2026 è“æ¡¥æ¯'; }
    }

    window.openRegisterModal=function(){
        document.getElementById('register-modal').classList.remove('hidden');
        document.getElementById('reg-message').classList.add('hidden');
    };
    window.closeRegisterModal=function(){
        document.getElementById('register-modal').classList.add('hidden');
        document.getElementById('reg-name').value='';
        document.getElementById('reg-studentid').value='';
        document.getElementById('reg-contact').value='';
    };
    window.submitRegister=async function(){
        const name=document.getElementById('reg-name').value.trim();
        const studentId=document.getElementById('reg-studentid').value.trim();
        const contact=document.getElementById('reg-contact').value.trim();
        const msgEl=document.getElementById('reg-message');
        if (!name||!studentId||!contact) {
            msgEl.textContent='âš ï¸ è¯·å¡«å†™æ‰€æœ‰ä¿¡æ¯';
            msgEl.className='text-sm text-center text-yellow-500';
            msgEl.classList.remove('hidden'); return;
        }
        try {
            const res=await fetch('http://localhost:8080/api/register',{
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({activityId:currentActivityId,studentName:name,studentId,contact})
            });
            const result=await res.json();
            msgEl.classList.remove('hidden');
            if (result.success) {
                msgEl.textContent='âœ… '+result.message;
                msgEl.className='text-sm text-center text-teal dark:text-tealDark';
                setTimeout(()=>closeRegisterModal(),2000);
            } else {
                msgEl.textContent='âŒ '+result.message;
                msgEl.className='text-sm text-center text-red-400';
            }
        } catch(err) {
            msgEl.textContent='âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨';
            msgEl.className='text-sm text-center text-red-400';
            msgEl.classList.remove('hidden');
        }
    };

    // ==========================================
    // 6. ç”µç«æ¨¡å—ï¼ˆå¯¹æ¥åç«¯ï¼‰
    // ==========================================
    let currentActiveGame = 'valorant';

    async function loadRankData(game) {
        const tbody = document.getElementById('rank-table-body');
        tbody.innerHTML = `<tr><td colspan="4" class="py-8 text-center text-gray-400 font-mono animate-pulse">Loading...</td></tr>`;
        try {
            const res = await fetch(`http://localhost:8080/api/rank/${game}`);
            const result = await res.json();
            tbody.innerHTML = '';
            if (!result.success || result.data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="py-8 text-center text-gray-500">æš‚æ— æ•°æ®</td></tr>`;
                return;
            }
            result.data.forEach((p, i) => {
                let rc = 'text-gray-500', ri = '';
                if (i === 0) { rc = 'text-yellow-500'; ri = "<i class='bi bi-trophy-fill'></i>"; }
                if (i === 1) rc = 'text-gray-400';
                if (i === 2) rc = 'text-orange-700';
                // è®¡ç®—è·ç¦»æ›´æ–°æ—¶é—´
                const updated = p.updatedAt ? new Date(p.updatedAt) : null;
                const timeStr = updated ? timeSince(updated) : '-';
                tbody.innerHTML += `
                <tr class="border-b border-gray-100 dark:border-white/5 hover:bg-gray-50 dark:hover:bg-white/5 transition">
                    <td class="py-4 pl-2 font-bold font-mono ${rc}">${ri} #${i+1}</td>
                    <td class="py-4">
                        <div class="flex items-center gap-3">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=${p.avatarSeed||p.playerName}" class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700">
                            <span class="font-bold text-gray-800 dark:text-gray-200">${p.playerName}</span>
                        </div>
                    </td>
                    <td class="py-4">
                        <span class="bg-teal/10 dark:bg-tealDark/10 text-teal dark:text-tealDark px-2 py-1 rounded text-xs font-bold border border-teal/20">${p.rankName}</span>
                        <span class="text-xs text-gray-400 ml-1">${p.score}</span>
                    </td>
                    <td class="py-4 hidden md:table-cell text-xs font-mono text-gray-400">${timeStr}</td>
                </tr>`;
            });
        } catch (err) {
            tbody.innerHTML = `<tr><td colspan="4" class="py-8 text-center text-red-400 text-sm">æ— æ³•è¿æ¥åç«¯ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨</td></tr>`;
        }
    }

    // è®¡ç®—"å¤šä¹…å‰"çš„è¾…åŠ©å‡½æ•°
    function timeSince(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        if (seconds < 60) return 'just now';
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes}m ago`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours}h ago`;
        return `${Math.floor(hours / 24)}d ago`;
    }

    window.switchGame = function(game) {
        currentActiveGame = game;
        document.querySelectorAll('.game-tab').forEach(btn => {
            btn.className = btn.dataset.game === game
                ? 'game-tab active-tab px-5 py-2 rounded-lg text-sm font-bold transition-all border border-transparent'
                : 'game-tab px-5 py-2 rounded-lg text-sm font-bold text-gray-500 hover:text-teal dark:hover:text-tealDark transition-all border border-transparent';
        });
        const titles = { valorant:'VALORANT', naraka:'NARAKA', apex:'APEX', lol:'LEAGUE' };
        document.getElementById('rank-title').innerText = titles[game] || game.toUpperCase();
        loadRankData(game);
    };

    // ==========================================
    // 7. ä¸Šä¼ æˆ˜ç»©å¼¹çª—
    // ==========================================
    const modal=document.getElementById('ocr-modal');
    const modalContent=document.getElementById('ocr-modal-content');
    const confirmBtn=document.getElementById('confirm-upload-btn');

    window.openUploadModal=function(){
        modal.classList.remove('hidden');
        modalContent.classList.add('modal-animate-in'); modalContent.classList.remove('modal-animate-out');
        document.getElementById('upload-placeholder').classList.remove('hidden');
        document.getElementById('upload-preview').classList.add('hidden');
        document.getElementById('ocr-loading').classList.add('hidden');
        document.getElementById('ocr-result').classList.add('hidden');
        confirmBtn.disabled=true;
        confirmBtn.className='w-full bg-gray-200 dark:bg-white/10 text-gray-400 font-bold py-3 rounded-xl cursor-not-allowed transition mt-4';
    };
    window.closeUploadModal=function(){
        modalContent.classList.remove('modal-animate-in'); modalContent.classList.add('modal-animate-out');
        setTimeout(()=>modal.classList.add('hidden'),250);
    };
    window.handleFileSelect=function(inp){
        if(inp.files&&inp.files[0]){
            const reader=new FileReader();
            reader.onload=function(e){
                document.getElementById('upload-placeholder').classList.add('hidden');
                const img=document.getElementById('upload-preview');
                img.src=e.target.result; img.classList.remove('hidden');
                document.getElementById('ocr-loading').classList.remove('hidden');
                setTimeout(()=>{
                    document.getElementById('ocr-loading').classList.add('hidden');
                    document.getElementById('ocr-result').classList.remove('hidden');
                    document.getElementById('result-rank').value='è¶…å‡¡å…¥åœ£ 2 (88RR)';
                    confirmBtn.disabled=false;
                    confirmBtn.className='w-full bg-teal dark:bg-tealDark text-white dark:text-black font-bold py-3 rounded-xl hover:opacity-90 transition mt-4';
                },1500);
            };
            reader.readAsDataURL(inp.files[0]);
        }
    };

    window.submitRank = async function() {
        const playerName = document.getElementById('upload-id').value.trim();
        const rankFull = document.getElementById('result-rank').value.trim();
        if (!playerName) { alert('è¯·å¡«å†™æ¸¸æˆ ID'); return; }

        let rankName = rankFull, score = '';
        if (rankFull.includes('(')) {
            rankName = rankFull.split('(')[0].trim();
            score = rankFull.split('(')[1].replace(')', '').trim();
        }

        const btn = document.getElementById('confirm-upload-btn');
        btn.textContent = 'æäº¤ä¸­...';
        btn.disabled = true;

        try {
            const res = await fetch('http://localhost:8080/api/rank/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    game: currentActiveGame,
                    playerName, rankName, score,
                    avatarSeed: playerName
                })
            });
            const result = await res.json();
            if (result.success) {
                closeUploadModal();
                await loadRankData(currentActiveGame);
            } else {
                alert('æ›´æ–°å¤±è´¥ï¼š' + result.message);
                btn.textContent = 'ç¡®è®¤æ›´æ–°';
                btn.disabled = false;
            }
        } catch (err) {
            alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨');
            btn.textContent = 'ç¡®è®¤æ›´æ–°';
            btn.disabled = false;
        }
    };

    // ==========================================
    // 8. å¯åŠ¨
    // ==========================================
    ;(function init(){
        const savedTheme=localStorage.getItem('theme');
        const sysPrefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (savedTheme==='dark'||(!savedTheme&&sysPrefersDark)) document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
        updateCanvasColors();
        resize();
        animate();
        switchGame('valorant');
        loadActivities();
        loadAlumniMembers();
    })();
</script>
</body>
</html>